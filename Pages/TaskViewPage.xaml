<Page x:Class="GdzApp.Pages.TaskViewPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:conv="clr-namespace:GdzApp.Converters"
      Title="Задания учебника">
    <Page.Resources>
        <conv:ImageUrlConverter x:Key="ImageUrlConverter"/>
        <conv:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
    </Page.Resources>

    <DockPanel Margin="10">
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="← Назад" Click="BackButton_Click"/>
            <TextBlock x:Name="TitleText" FontSize="16" FontWeight="Bold" Margin="10,0,0,0" 
                       VerticalAlignment="Center" Foreground="{StaticResource PrimaryBrush}"/>
        </StackPanel>

        <ScrollViewer>
            <ItemsControl x:Name="TasksList">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderThickness="1" BorderBrush="#DDD" Padding="15" Margin="0,5" 
                                CornerRadius="4" Background="White">
                            <StackPanel>
                                <!-- Номер задания как на 3-м изображении -->
                                <TextBlock Text="{Binding Number}" FontSize="18" FontWeight="Bold" 
                                           Margin="0,0,0,10" Foreground="{StaticResource PrimaryBrush}"
                                           HorizontalAlignment="Left"/>

                                <!-- Заголовок задания -->
                                <TextBlock Text="{Binding Title}" FontSize="14" FontWeight="SemiBold" 
                                           Margin="0,0,0,10" TextWrapping="Wrap"/>

                                <!-- Текстовое решение с моноширинным шрифтом для формул -->
                                <Border Visibility="{Binding SolutionText, Converter={StaticResource StringToVisibilityConverter}}"
                                        Background="#F9F9F9" Padding="15" Margin="0,0,0,10"
                                        CornerRadius="4" BorderThickness="1" BorderBrush="#EEE">
                                    <TextBlock Text="{Binding SolutionText}" TextWrapping="Wrap" 
                                               FontSize="13" FontFamily="Courier New" LineHeight="18"/>
                                </Border>

                                <!-- Изображение решения с улучшенным качеством -->
                                <Border Visibility="{Binding SolutionImageUrl, Converter={StaticResource StringToVisibilityConverter}}"
                                        Margin="0,0,0,10" HorizontalAlignment="Left">
                                    <Image Source="{Binding SolutionImageUrl, Converter={StaticResource ImageUrlConverter}}" 
                                           MaxWidth="800" Stretch="Uniform"
                                           HorizontalAlignment="Left"/>
                                </Border>
                            </StackPanel>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </DockPanel>
</Page>